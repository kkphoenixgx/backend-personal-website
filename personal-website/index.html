<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading Content...</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; background-color: #f0f2f5; }
        .container { text-align: center; padding: 2rem; background-color: white; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        #status { font-size: 1.2rem; margin-bottom: 1rem; }
        #spinner { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 2s linear infinite; margin: 1rem auto; }
        #page-list { list-style-type: none; padding: 0; text-align: left; }
        #page-list li { margin: 0.5rem 0; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <div id="loading-state">
            <h1 id="status">Syncing content from repository...</h1>
            <p>This may take a minute on the first run.</p>
            <div id="spinner"></div>
        </div>
        <div id="ready-state" style="display: none;">
            <h1>Content Ready</h1>
            <p>The following pages are available:</p>
            <ul id="page-list"></ul>
        </div>
    </div>

    <script>
        const statusElement = document.getElementById('status');
        const loadingDiv = document.getElementById('loading-state');
        const readyDiv = document.getElementById('ready-state');
        const pageList = document.getElementById('page-list');

        async function checkStatus() {
            try {
                const response = await fetch('/api/pages');
                const syncStatus = response.headers.get('X-Sync-Status');

                if (syncStatus === 'COMPLETE') {
                    const pages = await response.json();
                    loadingDiv.style.display = 'none';
                    pageList.innerHTML = pages.map(page => `<li><a href="${page.path}">${page.title}</a></li>`).join('');
                    readyDiv.style.display = 'block';
                } else {
                    // Still pending, check again in 5 seconds
                    setTimeout(checkStatus, 5000);
                }
            } catch (error) {
                statusElement.textContent = 'Error checking status. Retrying...';
                setTimeout(checkStatus, 5000);
            }
        }

        // Start checking immediately on page load
        checkStatus();
    </script>
</body>
</html>